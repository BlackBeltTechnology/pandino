<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>App with inverter</title>
</head>
<body>
<h1>Hello!</h1>
<p id="text-to-invert">This text should be inverter!</p>

<script type="module">
    window.addEventListener('DOMContentLoaded', async () => {
        // 0. Import Pandino it self. Since we are running in the browsers with modules, we need the .mjs version.
        const Pandino = (await import('./pandino.mjs')).default;
        const pandino = new Pandino({
            'pandino.deployment.root': location.href,
            'pandino.manifest.fetcher': {
                fetch: async (deploymentRoot, uri) => (await fetch(uri)).json(),
            },
            'pandino.bundle.importer': {
                import: (deploymentRoot, activatorLocation) => import(activatorLocation),
            },
        });

        await pandino.init();
        await pandino.start();

        // Pandino should be up and running, which should be visible by looking at the console window of your browser's
        // dev-tools

        // 1. Install our new bundle via it's manifest:
        const context = pandino.getBundleContext();

        await context.installBundle('./string-inverter-manifest.json');

        // 2. Obtain a Service Object
        const inverterReference = context.getServiceReference('@example/string-inverter/StringInverter');
        const inverterService = context.getService(inverterReference);

        // 3. Use our Service to invert some text in our DOM
        const paragraphToInvert = document.getElementById('text-to-invert');
        paragraphToInvert.textContent = inverterService.invert(paragraphToInvert.textContent);
    });
</script>
</body>
</html>
